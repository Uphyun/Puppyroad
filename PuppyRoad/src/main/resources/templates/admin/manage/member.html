<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org/" layout:decorate="~{/common/layouts/admin_layout}"
      layout:fragment="Content">

<body>
      <div class="container-xxl flex-grow-1 container-p-y">
            <!-- Users List Table -->
            <div class="card">
                  <div class="card-header border-bottom">
                        <h5 class="card-title mb-0">Filters</h5>
                        <div class="d-flex justify-content-between align-items-center row pt-4 gap-4 gap-md-0">
                              <div class="col-md-4 user_role"></div>
                              <div class="col-md-4 user_plan"></div>
                              <div class="col-md-4 user_status"></div>
                        </div>
                  </div>
                  <div class="card-datatable table-responsive">
                        <div id="DataTables_Table_0_wrapper" class="dataTables_wrapper dt-bootstrap5 no-footer">
                              <div class="row">
                                    <div class="col-md-2">
                                          <div class="ms-n2">
                                                <div class="dataTables_length" id="DataTables_Table_0_length">
                                                      <label><select name="DataTables_Table_0_length"
                                                                  aria-controls="DataTables_Table_0"
                                                                  class="form-select">
                                                                  <option value="10">10</option>
                                                                  <option value="25">25</option>
                                                                  <option value="50">50</option>
                                                                  <option value="100">100</option>
                                                            </select></label>
                                                </div>
                                          </div>
                                    </div>
                                    <div class="col-md-10">
                                          <div
                                                class="dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-end flex-md-row flex-column mb-6 mb-md-0 mt-n6 mt-md-0">
                                                <div id="DataTables_Table_0_filter" class="dataTables_filter">
                                                      <label><input type="search" class="form-control"
                                                                  placeholder="Search User"
                                                                  aria-controls="DataTables_Table_0"></label>
                                                </div>
                                          </div>
                                    </div>
                              </div>
                              <table class="datatables-users table dataTable no-footer dtr-column"
                                    id="DataTables_Table_0" aria-describedby="DataTables_Table_0_info">
                                    <thead class="border-top">
                                          <tr>
                                                <th class="control sorting_disabled dtr-hidden" rowspan="1" colspan="1"
                                                      style="width: 28.9688px; display: none;" aria-label=""></th>
                                                <th class="sorting_disabled dt-checkboxes-cell dt-checkboxes-select-all"
                                                      rowspan="1" colspan="1" style="width: 24.1406px;" data-col="1"
                                                      aria-label=""><input type="checkbox" class="form-check-input">
                                                </th>
                                                <th class="sorting sorting_desc" tabindex="0"
                                                      aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                                                      style="width: 83.5312px;"
                                                      aria-label="닉네임: activate to sort column ascending">닉네임</th>
                                                <th class="sorting sorting_desc" tabindex="0"
                                                      aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                                                      style="width: 85.5312px;"
                                                      aria-label="아이디: activate to sort column ascending">아이디</th>
                                                <th class="sorting sorting_desc" tabindex="0"
                                                      aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                                                      style="width: 111.719px;"
                                                      aria-label="가입날짜: activate to sort column ascending">가입날짜</th>
                                                <th class="sorting sorting_desc" tabindex="0"
                                                      aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                                                      style="width: 111.719px;"
                                                      aria-label="활동날짜: activate to sort column ascending">활동날짜</th>
                                                <th class="sorting sorting_desc" tabindex="0"
                                                      aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                                                      style="width: 111.719px;"
                                                      aria-label="탈퇴날짜: activate to sort column ascending">탈퇴날짜</th>
                                                <th class="sorting_disabled" rowspan="1" colspan="1"
                                                      style="width: 116.359px;" aria-label="상세정보">상세정보</th>
                                                <th class="sorting_disabled" rowspan="1" colspan="1"
                                                      style="width: 116.359px;" aria-label="계정상태">계정상태</th>
                                          </tr>
                                    </thead>
                                    <tbody>
                                          <!-- <tr class="odd">
                                                <td valign="top" colspan="9" class="dataTables_empty">Loading...</td>
                                          </tr> -->
                                          <th:block th:each="member : ${memberList}">
                                                <tr class="odd">
                                                      <td rowspan="1" colspan="1" style="width: 83.5312px;"
                                                            class="dt-checkboxes-cell">
                                                            <input type="checkbox" class="form-check-input"
                                                                  th:value="${member.memberCode}">
                                                      </td>
                                                      <td style="width: 83.5312px;" class="dataTables_empty">[[
                                                            ${member.nickName} ]]
                                                      </td>
                                                      <td rowspan="1" colspan="1" style="width: 85.5312px;"
                                                            class="dataTables_empty">[[ ${member.userId} ]]
                                                      </td>
                                                      <td rowspan="1" colspan="1" style="width: 111.719px;"
                                                            class="dataTables_empty">
                                                            [[ ${#dates.format(member.joinDate, 'yyyy-MM-dd')} ]]
                                                      </td>
                                                      <td rowspan="1" colspan="1" style="width: 111.719px;"
                                                            class="dataTables_empty">
                                                            [[ ${#dates.format(member.activityDate, 'yyyy-MM-dd')} ]]
                                                      </td>
                                                      <td rowspan="1" colspan="1" style="width: 111.719px;"
                                                            class="dataTables_empty">
                                                            [[ ${#dates.format(member.withdrawDate, 'yyyy-MM-dd')} ]]
                                                      </td>
                                                      <td rowspan="1" colspan="1" style="width: 116.359px;"
                                                            class="dataTables_empty">
                                                            <button type="button"
                                                                  class="btn btn-primary waves-effect waves-light viewInfo"
                                                                  data-bs-toggle="modal" data-bs-target="#viewUser"
                                                                  th:data-memberCode="${member.memberCode}">
                                                                  상세보기
                                                            </button>
                                                      </td>
                                                      <td rowspan="1" colspan="1" style="width: 116.359px;"
                                                            class="dataTables_empty">
                                                            <div class="position-relative"><select
                                                                        class="select2 form-select select2-hidden-accessible accountState"
                                                                        data-select2-id="accountState" tabindex="-1"
                                                                        aria-hidden="true"
                                                                        data-memberCode="${member.memberCode}">
                                                                        <th:block th:if="${member.accountState == 1}">
                                                                              <option value="1" data-select2-id="2"
                                                                                    selected>정상
                                                                              </option>
                                                                              <option value="2">휴면</option>
                                                                              <option value="3">탈퇴</option>
                                                                        </th:block>
                                                                        <th:block th:if="${member.accountState == 2}">
                                                                              <option value="1" data-select2-id="2">정상
                                                                              </option>
                                                                              <option value="2" selected>휴면</option>
                                                                              <option value="3">탈퇴</option>
                                                                        </th:block>
                                                                        <th:block th:if="${member.accountState == 3}">
                                                                              <option value="1" data-select2-id="2">정상
                                                                              </option>
                                                                              <option value="2">휴면</option>
                                                                              <option value="3" selected>탈퇴</option>
                                                                        </th:block>
                                                                  </select>
                                                            </div>
                                                      </td>
                                                </tr>
                                          </th:block>
                                    </tbody>
                              </table>

                              <div class="row">
                                    <div class="col-sm-12 col-md-6">
                                          <div class="dataTables_info" id="DataTables_Table_0_info" role="status"
                                                aria-live="polite">Showing 0 to 0 of 0 entries</div>
                                    </div>
                                    <div class="col-sm-12 col-md-6">
                                          <div class="dataTables_paginate paging_simple_numbers"
                                                id="DataTables_Table_0_paginate">
                                                <ul class="pagination">
                                                      <li class="paginate_button page-item previous disabled"
                                                            id="DataTables_Table_0_previous"><a
                                                                  aria-controls="DataTables_Table_0"
                                                                  aria-disabled="true" role="link"
                                                                  data-dt-idx="previous" tabindex="-1"
                                                                  class="page-link"><i
                                                                        class="ti ti-chevron-left ti-sm"></i></a></li>
                                                      <li class="paginate_button page-item next disabled"
                                                            id="DataTables_Table_0_next"><a
                                                                  aria-controls="DataTables_Table_0"
                                                                  aria-disabled="true" role="link" data-dt-idx="next"
                                                                  tabindex="-1" class="page-link"><i
                                                                        class="ti ti-chevron-right ti-sm"></i></a></li>
                                                </ul>
                                          </div>
                                    </div>
                              </div>
                        </div>
                  </div>

                  <!-- View User Modal -->
                  <div class="modal fade" id="viewUser" tabindex="-1" style="display: none;" aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-simple modal-edit-user">
                              <div class="modal-content">
                                    <div class="modal-body">
                                          <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                          <div id="modal-memberInfo">
                                                <!-- Info table -->
                                                <div class="card">
                                                      <div class="text-center mb-3 mt-3">
                                                            <h5 class="mb-1 mt-1">회원정보</h5>
                                                      </div>
                                                      <div class="card-body">
                                                            <hr class="table-responsive text-nowrap">
                                                            <table class="table table-bordered text-center mb-2">
                                                                  <tr>
                                                                        <th>이름</th>
                                                                        <td colspan="3" id="infoName"></td>
                                                                        <th>닉네임</th>
                                                                        <td colspan="3" id="infoNick"></td>
                                                                        <th>연락처</th>
                                                                        <td colspan="3" id="infoPhone"></td>
                                                                  </tr>
                                                                  <tr>
                                                                        <th colspan="2">가입날짜</th>
                                                                        <td colspan="2" id="infoJoin"></td>
                                                                        <th colspan="2">활동날짜</th>
                                                                        <td colspan="2" id="infoActivity"></td>
                                                                        <th colspan="2">계정상태</th>
                                                                        <td colspan="2">
                                                                              <div class="position-relative">
                                                                                    <select id="modalAccountState"
                                                                                          class="select2 form-select select2-hidden-accessible"
                                                                                          data-select2-id="accountState"
                                                                                          tabindex="-1"
                                                                                          aria-hidden="true">
                                                                                          <option value="1"
                                                                                                data-select2-id="2"
                                                                                                selected>정상
                                                                                          </option>
                                                                                          <option value="2">휴면
                                                                                          </option>
                                                                                          <option value="3">탈퇴
                                                                                          </option>
                                                                                    </select>
                                                                              </div>
                                                                        </td>
                                                                  </tr>
                                                                  <tr>
                                                                        <th colspan="2">주소</th>
                                                                        <td colspan="10" id="infoAddress"
                                                                              class="text-start"></td>
                                                                  </tr>
                                                            </table>
                                                            <hr>

                                                            <h5 class="mb-2 pb-1">애완견 목록</h5>
                                                            <div id="puppyList">
                                                                  <div class="card">
                                                                        <div class="row">
                                                                              <div class="col-md-2">
                                                                                    <img class="card-img card-img-left"
                                                                                          src="/assets/admin/img/elements/9.jpg"
                                                                                          alt="Card image">
                                                                              </div>
                                                                              <div class="col-md-10">
                                                                                    <div class="card-body">
                                                                                          <div
                                                                                                class="table-responsive text-nowrap card-text">
                                                                                                <table
                                                                                                      class="table table-borderless">
                                                                                                      <tr>
                                                                                                            <th>이름 :
                                                                                                            </th>
                                                                                                            <td></td>
                                                                                                            <th>견종 :
                                                                                                            </th>
                                                                                                            <td></td>
                                                                                                            <th>성별 :
                                                                                                            </th>
                                                                                                            <td></td>
                                                                                                      </tr>
                                                                                                      <tr>
                                                                                                            <th>나이 :
                                                                                                            </th>
                                                                                                            <td></td>
                                                                                                            <th>중성화 유무 :
                                                                                                            </th>
                                                                                                            <td></td>
                                                                                                            <th>질병 유무 :
                                                                                                            </th>
                                                                                                            <td></td>
                                                                                                      </tr>
                                                                                                </table>
                                                                                          </div>
                                                                                    </div>
                                                                              </div>
                                                                        </div>
                                                                  </div>
                                                            </div>

                                                            <!-- close button -->
                                                            <div class="col-12 mt-3 text-center">
                                                                  <button type="button"
                                                                        class="btn btn-label-secondary waves-effect"
                                                                        data-bs-dismiss="modal" aria-label="Close">
                                                                        닫기
                                                                  </button>
                                                            </div>
                                                      </div>
                                                </div>
                                          </div>
                                    </div>
                              </div>
                        </div>
                  </div>
                  <!--/ View User Modal -->
            </div>
      </div>
      <script>
            $('.viewInfo').on("click", function () {
                  let memberCode = $(event.target).data("membercode");

                  $.ajax({
                        type: "get",
                        url: "/ajax/manageMember?memberCode=" + memberCode
                  })
                        .done(result => {
                              $("#infoName").text(result.name);
                              $("#infoNick").text(result.nickName);
                              $("#infoPhone").text(oninputPhone(result.phone));
                              $("#infoJoin").text(makeDateFormat(result.joinDate));
                              $("#infoActivity").text(makeDateFormat(result.activityDate));
                              $("#modalAccountState").val(result.accountState).prop("selected", true);
                              $("#modalAccountState").data("memberCode", result.memberCode);
                              $("#infoAddress").text(result.address);

                              let puppyList = result.puppyList;
                              $("#puppyList").html("");
                              console.log(puppyList);
                              puppyList.forEach(puppy => {
                                    $("#puppyList").append(appendPuppy(puppy));
                              })
                        })
                        .fail(err => console.log(err));
            })

            function makeDateFormat(date) {
                  let beforeDate = new Date(date);
                  let dateFormat = beforeDate.getFullYear() + "년 "
                        + ((beforeDate.getMonth() + 1) < 10 ? "0" + (beforeDate.getMonth() + 1) : (beforeDate.getMonth() + 1)) + "월 "
                        + (beforeDate.getDate() < 10 ? "0" + beforeDate.getDate() : beforeDate.getDate()) + "일";

                  return dateFormat;
            }

            function oninputPhone(phone) {
                  phone = phone
                        .replace(/[^0-9]/g, '')
                        .replace(/(^02.{0}|^01.{1}|[0-9]{3,4})([0-9]{3,4})([0-9]{4})/g, "$1-$2-$3");

                  return phone;
            }

            function appendPuppy(puppy) {
                  let cardDiv = $("div");
                  cardDiv.hasClass("card");

                  let rowDiv = $("div");
                  rowDiv.hasClass("row");

                  //image
                  let col2 = $("div");
                  col2.hasClass("col-md-2");
                  let imgTag = $("img");
                  imgTag.hasClass("card-img card-img-left");
                  imgTag.src = ContextPath + "/images/" + puppy.picture;
                  col2.append(imgTag);

                  rowDiv.append(col2);

                  //cardBody
                  let col10 = $("div");
                  col10.hasClass("col-md-10");
                  let cardBody = $("div");
                  cardBody.hasClass("card-body");
                  //table
                  let tableDiv = $("div");
                  tableDiv.hasClass("table-responsive text-nowrap card-text");
                  let tableTag = $("table");
                  tableTag.hasClass("table table-borderless");
                  let tr = $("tr");
                  tr.html(`
                        <th>이름 : </th>
                        <td>${puppy.dogName}</td>
                        <th>견종 : </th>
                        <td>${puppy.dogBreed}</td>
                        <th>성별 : </th>
                        <td>${puppy.gender}</td>
                  `);
                  //tableTag.append(tr);

                  tr.html(`
                        <th>나이 : </th>
                        <td>${puppy.age}</td>
                        <th>중성화 유무 : </th>
                        <td>${puppy.neutralizationPreAbs}</td>
                        <th>질병 유무 : </th>
                        <td>${puppy.diseasePreAbs}</td>
                  `);
                  //tableTag.append(tr);

                  tableDiv.append(tableTag);
                  cardBody.append(tableDiv);
                  col10.append(cardBody);
                  rowDiv.append(col10);
                  cardDiv.append(rowDiv);

                  return cardDiv;
            }
      </script>
</body>

</html>