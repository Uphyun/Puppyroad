<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.puppyroad.app.member.mapper.MemberMapper">
	<insert id="insertMember">
		<selectKey keyProperty="memberCode" order="BEFORE"
		resultType="string">
			SELECT nvl(max(to_number(substr(member_code, -3))), 0) + 1 as "member_code"
			FROM member
            WHERE substr(member_code, 2, 6) = to_char(sysdate, 'yymmdd')
		</selectKey>
		INSERT INTO MEMBER
		(
		    MEMBER_CODE
		    , USER_ID
		    , USER_PW
		    , NICKNAME
		    , NAME
		    , ADDRESS
		    , EMAIL
		    , PHONE
		    , JOIN_DATE
		    , POSITION
			<if test="position == '봉사인'">
		    	, INTENTION
			</if>
			 	, account_state

			
		)
		VALUES 
		(
			<choose>
			  <when test="position == '의뢰인'">
				'M' || to_char(sysdate, 'yyMMdd') || LPAD(#{memberCode}, 3, 0)
			  </when>
		      <otherwise>
				'W' || to_char(sysdate, 'yyMMdd') || LPAD(#{memberCode}, 3, 0)
		      </otherwise>
			</choose>
		    , #{userId}
		    , #{userPw}
		    , #{name}
		    , #{nickName}
		    , #{address}
		    , #{email}
		    , #{phone}
		    , sysdate
		    , #{position}
		    <if test="position == '봉사인'">
		    	, #{intention}
		    </if>
			, 1
		   
		 

		)
	</insert>
	
	<select id="idCheck" parameterType="String" resultType="int">
		SELECT count(*)
		FROM member
		WHERE user_id = #{userId}
	</select>
	
	
	<select id="getUserInfo" parameterType="MemberVO" resultType="MemberVO">
		SELECT user_id
			  ,user_pw
			  ,position
			  ,member_code
			  ,nickname
		FROM   member
		WHERE user_id = #{userId}
	</select>
	
	<select id="idFind" resultType="MemberVO">
		SELECT 	user_id,
				position
		FROM 	member
		WHERE   phone = #{phone}
	</select>
	
	<select id="memberGetInfo" resultType="MemberVO">
			SELECT 	
				user_id,
				user_pw,
				position,
				nickName,
				name,
				address,
				email,
				phone,
				join_date,
				activity_date,
				account_state,
				position
				<if test="position == '봉사인'">
				, intention
				</if>
		FROM 	member
		WHERE   user_id = #{userId}
	</select>
	<update id="memberUpdate">
		        
		UPDATE member
		   SET nickname = #{nickName},
			   address = #{address},
			   email = #{email},
			   phone = #{phone}
		WHERE  user_id = #{userId}
				
	</update>
	<delete id="memberDelete">
	<!-- UPDATE 로 변경해서 상태값 주기 -->
		DELETE member
		WHERE user_id = #{userId}
	
	</delete>
		

</mapper>