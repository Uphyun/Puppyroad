<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.puppyroad.app.match.mapper.MatchMapper">
  <!-- 전체 자율매칭 -->
  <select id="selectMatchList" resultType="MatchVO">
		SELECT  bulletin_no,
		 		cover_photo,
		 		title,
		 		writer,
		 		content,
		 		matching_state,
		 		start_time,
		 		end_time,
		 		writing_time,
		 		animal_count,
		 		walk_place_address,
		 		matching_kind,
		 		client_code
	    FROM    matching_board
	    ORDER BY bulletin_no desc
  </select>
  
  <!-- 단건 자율매칭 -->
  <select id="selectMatchInfo" resultType="MatchVO">
		SELECT  bulletin_no,
		 		cover_photo,
		 		title,
		 		writer,
		 		content,
		 		matching_state,
		 		start_time,
		 		end_time,
		 		writing_time,
		 		animal_count,
		 		walk_place_address,
		 		matching_kind,
		 		client_code
	    FROM    matching_board
        WHERE   bulletin_no = #{bulletinNo}
  </select>
  
  <!-- 자율등록 -->
  <insert id="insertMatch" parameterType="MatchVO">
        <selectKey keyProperty="bulletinNo"
                   resultType="Integer"
                   order="BEFORE">
			SELECT NVL(MAX(bulletin_no), 0) + 1
			FROM   matching_board
        </selectKey>
		INSERT INTO matching_board(
								bulletin_no,
				 				cover_photo,
				 				title,
				 				writer,
				 				content,
							 	matching_state,
							 	start_time,
							 	end_time,
							 	writing_time,
							 	animal_count,
							 	walk_place_address,
							 	matching_kind,
							 	client_code)
		VALUES (#{bulletinNo},
		        #{coverPhoto},
		        #{title},
		        #{writer},
		        #{content},
		        1,
		        #{startTime},
		        #{endTime},
		        sysdate,
		        #{animalCount},
		        #{walkPlaceAddress},
		        #{matchingKind},
		        #{clientCode})
  </insert>
  
  <!-- 자율매칭의 반려견 저장 -->
  <insert id="insertMatchingPuppy" parameterType="MatchVO">
  	INSERT INTO matching_puppy(bulletin_no,
                               puppy_code)
    VALUES(#{bulletinNo},
           #{puppyCode})
  </insert>
    
  <!-- 자율수정 -->
  <update id="updateMatch" parameterType="MatchVO">
  	UPDATE matching_board
  	SET
  	       cover_photo = #{coverPhoto},
  	       title = #{title},
  	       writer = #{writer},
  	       content = #{content},
  	       matching_state = #{matchingState},
  	       walk_place_address = #{walkPlaceAddress},
  	       client_code = #{clientCode}
  	WHERE  bulletin_no = #{bulletinNo}
  </update>
  
  <!-- 자율삭제 -->
  <delete id="deleteMatch" parameterType="int">
  	DELETE matching_board
  	WHERE  bulletin_no = #{bulletinNo}
  </delete>
  
</mapper>