<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.puppyroad.app.match.mapper.MatchMapper">
  <!-- 전체 자율매칭 -->
  <select id="selectMatchList" resultType="MatchVO">
		SELECT  bulletin_no,
		 		cover_photo,
		 		title,
		 		writer,
		 		content,
		 		matching_state,
		 		start_time,
		 		end_time,
		 		writing_time,
		 		animal_count,
		 		walk_place_address,
		 		matching_kind,
		 		client_code
	    FROM    matching_board
	    ORDER BY bulletin_no desc
  </select>
  
  <!-- 개 전체 리스트 -->
  <select id="selectDogMatchList" resultType="MatchVO">
		SELECT   a.puppy_code puppy_code,
		         a.dog_name dog_name,
		         a.dog_breed dog_breed,
		         a.age age,
		         a.gender gender,
		         a.dog_size dog_size,
		         a.personality personality,
		         a.neutralization_pre_abs neutralization_pre_abs,
		         a.disease_pre_abs disease_pre_abs
	    FROM     puppy a JOIN member b
	      ON     a.client_user_id = b.member_code
	    WHERE    b.user_id = #{userId}
	    ORDER BY puppy_code
        
  </select>
  
  <!-- 개 단건 리스트 -->
  <select id="selectDogMatchInfo" resultType="MatchVO">
		SELECT   puppy_code,
		         dog_name,
		         dog_breed,
		         age,
		         gender,
		         dog_size,
		         personality,
		         neutralization_pre_abs,
		         disease_pre_abs
	    FROM     puppy
        WHERE    puppy_code = #{puppyCode}
        ORDER BY dog_name
  </select>
  
  <!-- 단건 자율매칭 -->
  <select id="selectMatchInfo" resultType="MatchVO">
		SELECT  bulletin_no,
		 		cover_photo,
		 		title,
		 		writer,
		 		content,
		 		matching_state,
		 		start_time,
		 		end_time,
		 		writing_time,
		 		animal_count,
		 		walk_place_address,
		 		matching_kind,
		 		client_code
	    FROM    matching_board
        WHERE   bulletin_no = #{bulletinNo}
  </select>
  
  <!-- 자율등록 -->
  <insert id="insertMatch" parameterType="MatchVO">
        <selectKey keyProperty="bulletinNo"
                   resultType="Integer"
                   order="BEFORE">
			SELECT NVL(MAX(bulletin_no), 0) + 1
			FROM   matching_board
        </selectKey>
		INSERT INTO matching_board(
								bulletin_no,
				 				cover_photo,
				 				title,
				 				writer,
				 				content,
							 	matching_state,
							 	start_time,
							 	end_time,
							 	writing_time,
							 	animal_count,
							 	walk_place_address,
							 	matching_kind,
							 	client_code)
		VALUES (#{bulletinNo},
		        #{coverPhoto},
		        #{title},
		        #{writer},
		        #{content},
		        1,
		        #{startTime},
		        #{endTime},
		        sysdate,
		        #{animalCount},
		        #{walkPlaceAddress},
		        #{matchingKind},
		        #{clientCode})
  </insert>
  
  <!-- 자율매칭의 반려견 저장 -->
  <insert id="insertMatchingPuppy" parameterType="MatchVO">
  	INSERT INTO matching_puppy(bulletin_no,
                               puppy_code)
    VALUES(#{bulletinNo},
           #{puppyCode})
  </insert>
    
  <!-- 자율수정 -->
  <update id="updateMatch" parameterType="MatchVO">
  	UPDATE matching_board
  	SET
  	       cover_photo = #{coverPhoto},
  	       title = #{title},
  	       writer = #{writer},
  	       content = #{content},
  	       matching_state = #{matchingState},
  	       start_time = #{startTime},
  	       end_time = #{endTime},
  	       writing_time = #{writingTime},
  	       animal_count = #{animalCount},
  	       walk_place_address = #{walkPlaceAddress},
  	       matching_kind = #{matchingKind},
  	       client_code = #{clientCode},
  	WHERE  bulletin_no = #{bulletinNo}
  </update>
  
  <!-- 자율삭제 -->
  <delete id="deleteMatch" parameterType="int">
  	DELETE matching_board
  	WHERE  bulletin_no = #{bulletinNo}
  </delete>
  
</mapper>