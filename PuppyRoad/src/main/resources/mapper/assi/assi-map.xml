<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.puppyroad.app.assi.mapper.AssiMapper">
  <!-- 전체 자율매칭 -->
  <select id="selectAssiList" resultType="AssiVO">
        SELECT  mb.bulletin_no,
		 		mb.cover_photo,
		 		mb.title,
		 		m.nickname as "writer",
		 		mb.content,
		 		mb.matching_state,
		 		mb.start_time,
		 		mb.end_time,
		 		mb.writing_time,
		 		mb.animal_count,
		 		mb.walk_place_address,
		 		mb.matching_kind,
		 		mb.client_code,
		 		wa.work_week,
		 		wa.work_time,
		 		wa.price,
		 		wa.picture,
		 		wa.gender,
		 		wa.bank_code,
		 		wa.bank_account
	    FROM    matching_board mb join member m
	    							on mb.writer = m.member_code
	    						  join walker_add_info wa
	    						    on m.member_code = wa.member_code
	    WHERE   mb.matching_kind = '대리'
	    ORDER BY bulletin_no desc
	    
  </select>
  
  <!-- 단건 조회 -->
  <select id="selectAssiInfo" resultType="AssiVO">
        SELECT  mb.bulletin_no,
		 		mb.cover_photo,
		 		mb.title,
		 		m.nickname as "writer",
		 		mb.content,
		 		mb.matching_state,
		 		mb.start_time,
		 		mb.end_time,
		 		mb.writing_time,
		 		mb.animal_count,
		 		mb.walk_place_address,
		 		mb.matching_kind,
		 		mb.client_code,
		 		wa.work_week,
		 		wa.work_time,
		 		wa.price,
		 		wa.picture,
		 		wa.gender,
		 		wa.bank_code,
		 		wa.bank_account
	    FROM    matching_board mb join member m
	    							on mb.writer = m.member_code
	    						  join walker_add_info wa
	    						    on m.member_code = wa.member_code
	    WHERE   mb.bulletin_no = #{bulletinNo}
  </select>
  
  <!-- 단건 도그워커 프로필 조회 -->
  <select id="selectWalkerInfo" resultType="WalkerAddInfoVO">
  		SELECT 
				member_code,
				gender,
				bank_code,
				bank_account,
				picture,
				work_week,
				work_time,
				preference_location,
				approval_state,
				memo,
				s_size,
				m_size,
				l_size
  		FROM    walker_add_info
  		WHERE   member_code = ( SELECT member_code
  		                        FROM   member
  		                        Where  user_id = #{writer} )
  </select>
  
  <!-- 내 도그워커 프로필 조회 -->
  <select id="selectmyWalkerInfo">
  		SELECT 
				member_code,
				gender,
				bank_code,
				bank_account,
				picture,
				work_week,
				work_time,
				preference_location,
				approval_state,
				memo,
				s_size,
				m_size,
				l_size,
				price
	 	FROM    walker_add_info
	 	WHERE   member_code = #{mcode}
  
  </select>
  
  <!-- 대리매칭 등록 -->
  <!-- 자율등록 -->
  <insert id="insertAssiInfo" parameterType="AssiVO">
        <selectKey keyProperty="bulletinNo"
                   resultType="Integer"
                   order="BEFORE">
			SELECT NVL(MAX(bulletin_no), 0) + 1
			FROM   matching_board
        </selectKey>
		INSERT INTO matching_board(
								bulletin_no,
				 				cover_photo,
				 				title,
				 				writer,
				 				content,
							 	matching_state,
							 	start_time,
							 	end_time,
							 	writing_time,
							 	animal_count,
							 	walk_place_address,
							 	matching_kind,
							 	client_code)
		VALUES (#{bulletinNo},
		        #{coverPhoto},
		        #{title},
		        #{writer},
		        #{content},
		        1,
		        #{startTime},
		        #{endTime},
		        sysdate,
		        #{animalCount},
		        #{walkPlaceAddress},
		        '대리',
		        #{clientCode})
  </insert>
  

</mapper>